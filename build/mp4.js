var Ee=(()=>{var p=import.meta.url;return function(h){var t=h||{},t=typeof t<"u"?t:{},g,m;t.ready=new Promise(function(e,r){g=e,m=r}),t.create_buffer=function(r){return t._malloc(r)},t.free_buffer=function(r){return t._free(r)},t.locateFile=function(r,n){return t.simd&&(r=r.replace(/\.wasm$/i,".simd.wasm")),t.getWasmPath?t.getWasmPath(r,n,t.simd):n+r},t.createWebCodecsEncoder=function(r){return vn(t,r)};var l=Object.assign({},t),v=[],M="./this.program",D=(e,r)=>{throw r},j=typeof window=="object",B=typeof importScripts=="function",re=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function k(e){return t.locateFile?t.locateFile(e,y):y+e}var z,oe,q,ae;(j||B)&&(B?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),p&&(y=p),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",z=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(null),r.responseText},B&&(q=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),oe=(e,r,n)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{if(i.status==200||i.status==0&&i.response){r(i.response);return}n()},i.onerror=n,i.send(null)},ae=e=>document.title=e);var Te=t.print||console.log.bind(console),I=t.printErr||console.warn.bind(console);Object.assign(t,l),l=null,t.arguments&&(v=t.arguments),t.thisProgram&&(M=t.thisProgram),t.quit&&(D=t.quit);var N=4,X;t.wasmBinary&&(X=t.wasmBinary);var Fe=t.noExitRuntime||!0;typeof WebAssembly!="object"&&te("no native wasm support detected");var K,w=!1,b;function O(e,r,n){for(var i=r+n,o="";!(r>=i);){var a=e[r++];if(!a)return o;if(!(a&128)){o+=String.fromCharCode(a);continue}var s=e[r++]&63;if((a&224)==192){o+=String.fromCharCode((a&31)<<6|s);continue}var u=e[r++]&63;if((a&240)==224?a=(a&15)<<12|s<<6|u:a=(a&7)<<18|s<<12|u<<6|e[r++]&63,a<65536)o+=String.fromCharCode(a);else{var f=a-65536;o+=String.fromCharCode(55296|f>>10,56320|f&1023)}}return o}function E(e,r){return e?O(U,e,r):""}function V(e,r,n,i){if(!(i>0))return 0;for(var o=n,a=n+i-1,s=0;s<e.length;++s){var u=e.charCodeAt(s);if(u>=55296&&u<=57343){var f=e.charCodeAt(++s);u=65536+((u&1023)<<10)|f&1023}if(u<=127){if(n>=a)break;r[n++]=u}else if(u<=2047){if(n+1>=a)break;r[n++]=192|u>>6,r[n++]=128|u&63}else if(u<=65535){if(n+2>=a)break;r[n++]=224|u>>12,r[n++]=128|u>>6&63,r[n++]=128|u&63}else{if(n+3>=a)break;r[n++]=240|u>>18,r[n++]=128|u>>12&63,r[n++]=128|u>>6&63,r[n++]=128|u&63}}return r[n]=0,n-o}function T(e,r,n){return V(e,U,r,n)}function ce(e){for(var r=0,n=0;n<e.length;++n){var i=e.charCodeAt(n);i<=127?r++:i<=2047?r+=2:i>=55296&&i<=57343?(r+=4,++n):r+=3}return r}var le,U,J,de,Y,S,Ce,Ue;function Re(){var e=K.buffer;t.HEAP8=le=new Int8Array(e),t.HEAP16=J=new Int16Array(e),t.HEAP32=Y=new Int32Array(e),t.HEAPU8=U=new Uint8Array(e),t.HEAPU16=de=new Uint16Array(e),t.HEAPU32=S=new Uint32Array(e),t.HEAPF32=Ce=new Float32Array(e),t.HEAPF64=Ue=new Float64Array(e)}var _n=t.INITIAL_MEMORY||16777216,Pe,ke=[],Se=[],We=[],Ze=!1;function $e(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)Qe(t.preRun.shift());pe(ke)}function Ke(){Ze=!0,pe(Se)}function Je(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)rr(t.postRun.shift());pe(We)}function Qe(e){ke.unshift(e)}function er(e){Se.unshift(e)}function rr(e){We.unshift(e)}var G=0,ve=null,ne=null;function nr(e){G++,t.monitorRunDependencies&&t.monitorRunDependencies(G)}function tr(e){if(G--,t.monitorRunDependencies&&t.monitorRunDependencies(G),G==0&&(ve!==null&&(clearInterval(ve),ve=null),ne)){var r=ne;ne=null,r()}}function te(e){t.onAbort&&t.onAbort(e),e="Aborted("+e+")",I(e),w=!0,b=1,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw m(r),r}var ir="data:application/octet-stream;base64,";function Ie(e){return e.startsWith(ir)}var R;t.locateFile?(R="mp4.wasm",Ie(R)||(R=k(R))):R=new URL("mp4.wasm",import.meta.url).href;function Oe(e){try{if(e==R&&X)return new Uint8Array(X);if(q)return q(e);throw"both async and sync fetching of the wasm failed"}catch(r){te(r)}}function or(){return!X&&(j||B)&&typeof fetch=="function"?fetch(R,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+R+"'";return e.arrayBuffer()}).catch(function(){return Oe(R)}):Promise.resolve().then(function(){return Oe(R)})}function ar(){var e={a:un};function r(s,u){var f=s.exports;t.asm=f,K=t.asm.x,Re(),Pe=t.asm.B,er(t.asm.y),tr("wasm-instantiate")}nr("wasm-instantiate");function n(s){r(s.instance)}function i(s){return or().then(function(u){return WebAssembly.instantiate(u,e)}).then(function(u){return u}).then(s,function(u){I("failed to asynchronously prepare wasm: "+u),te(u)})}function o(){return!X&&typeof WebAssembly.instantiateStreaming=="function"&&!Ie(R)&&typeof fetch=="function"?fetch(R,{credentials:"same-origin"}).then(function(s){var u=WebAssembly.instantiateStreaming(s,e);return u.then(n,function(f){return I("wasm streaming compile failed: "+f),I("falling back to ArrayBuffer instantiation"),i(n)})}):i(n)}if(t.instantiateWasm)try{var a=t.instantiateWasm(e,r);return a}catch(s){I("Module.instantiateWasm callback failed with error: "+s),m(s)}return o().catch(m),{}}function pe(e){for(;e.length>0;)e.shift()(t)}function ur(e,r,n,i){te("Assertion failed: "+E(e)+", at: "+[r?E(r):"unknown filename",n,i?E(i):"unknown function"])}function fr(e,r,n,i,o){}function he(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}function sr(){for(var e=new Array(256),r=0;r<256;++r)e[r]=String.fromCharCode(r);Ve=e}var Ve=void 0;function P(e){for(var r="",n=e;U[n];)r+=Ve[U[n++]];return r}var Q={},Z={},ue={},cr=48,lr=57;function He(e){if(e===void 0)return"_unknown";e=e.replace(/[^a-zA-Z0-9_]/g,"$");var r=e.charCodeAt(0);return r>=cr&&r<=lr?"_"+e:e}function Le(e,r){return e=He(e),new Function("body","return function "+e+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(r)}function ge(e,r){var n=Le(r,function(i){this.name=r,this.message=i;var o=new Error(i).stack;o!==void 0&&(this.stack=this.toString()+`
`+o.replace(/^Error(:[^\n]*)?\n/,""))});return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},n}var Me=void 0;function F(e){throw new Me(e)}var De=void 0;function je(e){throw new De(e)}function dr(e,r,n){e.forEach(function(u){ue[u]=r});function i(u){var f=n(u);f.length!==e.length&&je("Mismatched type converter count");for(var c=0;c<e.length;++c)H(e[c],f[c])}var o=new Array(r.length),a=[],s=0;r.forEach((u,f)=>{Z.hasOwnProperty(u)?o[f]=Z[u]:(a.push(u),Q.hasOwnProperty(u)||(Q[u]=[]),Q[u].push(()=>{o[f]=Z[u],++s,s===a.length&&i(o)}))}),a.length===0&&i(o)}function H(e,r,n={}){if(!("argPackAdvance"in r))throw new TypeError("registerType registeredInstance requires argPackAdvance");var i=r.name;if(e||F('type "'+i+'" must have a positive integer typeid pointer'),Z.hasOwnProperty(e)){if(n.ignoreDuplicateRegistrations)return;F("Cannot register type '"+i+"' twice")}if(Z[e]=r,delete ue[e],Q.hasOwnProperty(e)){var o=Q[e];delete Q[e],o.forEach(a=>a())}}function vr(e,r,n,i,o){var a=he(n);r=P(r),H(e,{name:r,fromWireType:function(s){return!!s},toWireType:function(s,u){return u?i:o},argPackAdvance:8,readValueFromPointer:function(s){var u;if(n===1)u=le;else if(n===2)u=J;else if(n===4)u=Y;else throw new TypeError("Unknown boolean type size: "+r);return this.fromWireType(u[s>>a])},destructorFunction:null})}var _e=[],W=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function me(e){e>4&&--W[e].refcount===0&&(W[e]=void 0,_e.push(e))}function pr(){for(var e=0,r=5;r<W.length;++r)W[r]!==void 0&&++e;return e}function hr(){for(var e=5;e<W.length;++e)if(W[e]!==void 0)return W[e];return null}function gr(){t.count_emval_handles=pr,t.get_first_emval=hr}var C={toValue:e=>(e||F("Cannot use deleted val. handle = "+e),W[e].value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var r=_e.length?_e.pop():W.length;return W[r]={refcount:1,value:e},r}}}};function ye(e){return this.fromWireType(Y[e>>2])}function _r(e,r){r=P(r),H(e,{name:r,fromWireType:function(n){var i=C.toValue(n);return me(n),i},toWireType:function(n,i){return C.toHandle(i)},argPackAdvance:8,readValueFromPointer:ye,destructorFunction:null})}function mr(e,r){switch(r){case 2:return function(n){return this.fromWireType(Ce[n>>2])};case 3:return function(n){return this.fromWireType(Ue[n>>3])};default:throw new TypeError("Unknown float type: "+e)}}function yr(e,r,n){var i=he(n);r=P(r),H(e,{name:r,fromWireType:function(o){return o},toWireType:function(o,a){return a},argPackAdvance:8,readValueFromPointer:mr(r,i),destructorFunction:null})}function wr(e,r){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var n=Le(e.name||"unknownFunctionName",function(){});n.prototype=e.prototype;var i=new n,o=e.apply(i,r);return o instanceof Object?o:i}function Be(e){for(;e.length;){var r=e.pop(),n=e.pop();n(r)}}function br(e,r,n,i,o){var a=r.length;a<2&&F("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var s=r[1]!==null&&n!==null,u=!1,f=1;f<r.length;++f)if(r[f]!==null&&r[f].destructorFunction===void 0){u=!0;break}for(var c=r[0].name!=="void",A="",d="",f=0;f<a-2;++f)A+=(f!==0?", ":"")+"arg"+f,d+=(f!==0?", ":"")+"arg"+f+"Wired";var _="return function "+He(e)+"("+A+`) {
if (arguments.length !== `+(a-2)+`) {
throwBindingError('function `+e+" called with ' + arguments.length + ' arguments, expected "+(a-2)+` args!');
}
`;u&&(_+=`var destructors = [];
`);var $=u?"destructors":"null",x=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ie=[F,i,o,Be,r[0],r[1]];s&&(_+="var thisWired = classParam.toWireType("+$+`, this);
`);for(var f=0;f<a-2;++f)_+="var arg"+f+"Wired = argType"+f+".toWireType("+$+", arg"+f+"); // "+r[f+2].name+`
`,x.push("argType"+f),ie.push(r[f+2]);if(s&&(d="thisWired"+(d.length>0?", ":"")+d),_+=(c?"var rv = ":"")+"invoker(fn"+(d.length>0?", ":"")+d+`);
`,u)_+=`runDestructors(destructors);
`;else for(var f=s?1:2;f<r.length;++f){var ee=f===1?"thisWired":"arg"+(f-2)+"Wired";r[f].destructorFunction!==null&&(_+=ee+"_dtor("+ee+"); // "+r[f].name+`
`,x.push(ee+"_dtor"),ie.push(r[f].destructorFunction))}c&&(_+=`var ret = retType.fromWireType(rv);
return ret;
`),_+=`}
`,x.push(_);var ln=wr(Function,x).apply(null,ie);return ln}function Ar(e,r,n){if(e[r].overloadTable===void 0){var i=e[r];e[r]=function(){return e[r].overloadTable.hasOwnProperty(arguments.length)||F("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[r].overloadTable+")!"),e[r].overloadTable[arguments.length].apply(this,arguments)},e[r].overloadTable=[],e[r].overloadTable[i.argCount]=i}}function Er(e,r,n){t.hasOwnProperty(e)?((n===void 0||t[e].overloadTable!==void 0&&t[e].overloadTable[n]!==void 0)&&F("Cannot register public name '"+e+"' twice"),Ar(t,e,e),t.hasOwnProperty(n)&&F("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),t[e].overloadTable[n]=r):(t[e]=r,n!==void 0&&(t[e].numArguments=n))}function Tr(e,r){for(var n=[],i=0;i<e;i++)n.push(S[r+i*4>>2]);return n}function Fr(e,r,n){t.hasOwnProperty(e)||je("Replacing nonexistant public symbol"),t[e].overloadTable!==void 0&&n!==void 0?t[e].overloadTable[n]=r:(t[e]=r,t[e].argCount=n)}function Cr(e,r,n){var i=t["dynCall_"+e];return n&&n.length?i.apply(null,[r].concat(n)):i.call(null,r)}var fe=[];function Ne(e){var r=fe[e];return r||(e>=fe.length&&(fe.length=e+1),fe[e]=r=Pe.get(e)),r}function Ur(e,r,n){if(e.includes("j"))return Cr(e,r,n);var i=Ne(r).apply(null,n);return i}function Rr(e,r){var n=[];return function(){return n.length=0,Object.assign(n,arguments),Ur(e,r,n)}}function Pr(e,r){e=P(e);function n(){return e.includes("j")?Rr(e,r):Ne(r)}var i=n();return typeof i!="function"&&F("unknown function pointer with signature "+e+": "+r),i}var xe=void 0;function ze(e){var r=qe(e),n=P(r);return L(r),n}function kr(e,r){var n=[],i={};function o(a){if(!i[a]&&!Z[a]){if(ue[a]){ue[a].forEach(o);return}n.push(a),i[a]=!0}}throw r.forEach(o),new xe(e+": "+n.map(ze).join([", "]))}function Sr(e,r,n,i,o,a){var s=Tr(r,n);e=P(e),o=Pr(i,o),Er(e,function(){kr("Cannot call "+e+" due to unbound types",s)},r-1),dr([],s,function(u){var f=[u[0],null].concat(u.slice(1));return Fr(e,br(e,f,null,o,a),r-1),[]})}function Wr(e,r,n){switch(r){case 0:return n?function(o){return le[o]}:function(o){return U[o]};case 1:return n?function(o){return J[o>>1]}:function(o){return de[o>>1]};case 2:return n?function(o){return Y[o>>2]}:function(o){return S[o>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function Ir(e,r,n,i,o){r=P(r),o===-1&&(o=4294967295);var a=he(n),s=d=>d;if(i===0){var u=32-8*n;s=d=>d<<u>>>u}var f=r.includes("unsigned"),c=(d,_)=>{},A;f?A=function(d,_){return c(_,this.name),_>>>0}:A=function(d,_){return c(_,this.name),_},H(e,{name:r,fromWireType:s,toWireType:A,argPackAdvance:8,readValueFromPointer:Wr(r,a,i!==0),destructorFunction:null})}function Or(e,r,n){var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],o=i[r];function a(s){s=s>>2;var u=S,f=u[s],c=u[s+1];return new o(u.buffer,c,f)}n=P(n),H(e,{name:n,fromWireType:a,argPackAdvance:8,readValueFromPointer:a},{ignoreDuplicateRegistrations:!0})}function Vr(e,r){r=P(r);var n=r==="std::string";H(e,{name:r,fromWireType:function(i){var o=S[i>>2],a=i+4,s;if(n)for(var u=a,f=0;f<=o;++f){var c=a+f;if(f==o||U[c]==0){var A=c-u,d=E(u,A);s===void 0?s=d:(s+=String.fromCharCode(0),s+=d),u=c+1}}else{for(var _=new Array(o),f=0;f<o;++f)_[f]=String.fromCharCode(U[a+f]);s=_.join("")}return L(i),s},toWireType:function(i,o){o instanceof ArrayBuffer&&(o=new Uint8Array(o));var a,s=typeof o=="string";s||o instanceof Uint8Array||o instanceof Uint8ClampedArray||o instanceof Int8Array||F("Cannot pass non-string to std::string"),n&&s?a=ce(o):a=o.length;var u=be(4+a+1),f=u+4;if(S[u>>2]=a,n&&s)T(o,f,a+1);else if(s)for(var c=0;c<a;++c){var A=o.charCodeAt(c);A>255&&(L(f),F("String has UTF-16 code units that do not fit in 8 bits")),U[f+c]=A}else for(var c=0;c<a;++c)U[f+c]=o[c];return i!==null&&i.push(L,u),u},argPackAdvance:8,readValueFromPointer:ye,destructorFunction:function(i){L(i)}})}function Hr(e,r){for(var n="",i=0;!(i>=r/2);++i){var o=J[e+i*2>>1];if(o==0)break;n+=String.fromCharCode(o)}return n}function Lr(e,r,n){if(n===void 0&&(n=2147483647),n<2)return 0;n-=2;for(var i=r,o=n<e.length*2?n/2:e.length,a=0;a<o;++a){var s=e.charCodeAt(a);J[r>>1]=s,r+=2}return J[r>>1]=0,r-i}function Mr(e){return e.length*2}function Dr(e,r){for(var n=0,i="";!(n>=r/4);){var o=Y[e+n*4>>2];if(o==0)break;if(++n,o>=65536){var a=o-65536;i+=String.fromCharCode(55296|a>>10,56320|a&1023)}else i+=String.fromCharCode(o)}return i}function jr(e,r,n){if(n===void 0&&(n=2147483647),n<4)return 0;for(var i=r,o=i+n-4,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343){var u=e.charCodeAt(++a);s=65536+((s&1023)<<10)|u&1023}if(Y[r>>2]=s,r+=4,r+4>o)break}return Y[r>>2]=0,r-i}function Br(e){for(var r=0,n=0;n<e.length;++n){var i=e.charCodeAt(n);i>=55296&&i<=57343&&++n,r+=4}return r}function Nr(e,r,n){n=P(n);var i,o,a,s,u;r===2?(i=Hr,o=Lr,s=Mr,a=()=>de,u=1):r===4&&(i=Dr,o=jr,s=Br,a=()=>S,u=2),H(e,{name:n,fromWireType:function(f){for(var c=S[f>>2],A=a(),d,_=f+4,$=0;$<=c;++$){var x=f+4+$*r;if($==c||A[x>>u]==0){var ie=x-_,ee=i(_,ie);d===void 0?d=ee:(d+=String.fromCharCode(0),d+=ee),_=x+r}}return L(f),d},toWireType:function(f,c){typeof c!="string"&&F("Cannot pass non-string to C++ string type "+n);var A=s(c),d=be(4+A+r);return S[d>>2]=A>>u,o(c,d+4,A+r),f!==null&&f.push(L,d),d},argPackAdvance:8,readValueFromPointer:ye,destructorFunction:function(f){L(f)}})}function xr(e,r){r=P(r),H(e,{isVoid:!0,name:r,argPackAdvance:0,fromWireType:function(){},toWireType:function(n,i){}})}function we(e,r){var n=Z[e];return n===void 0&&F(r+" has unknown type "+ze(e)),n}function zr(e,r,n){e=C.toValue(e),r=we(r,"emval::as");var i=[],o=C.toHandle(i);return S[n>>2]=o,r.toWireType(i,e)}function qr(e,r){for(var n=new Array(e),i=0;i<e;++i)n[i]=we(S[r+i*N>>2],"parameter "+i);return n}function Xr(e,r,n,i){e=C.toValue(e);for(var o=qr(r,n),a=new Array(r),s=0;s<r;++s){var u=o[s];a[s]=u.readValueFromPointer(i),i+=u.argPackAdvance}var f=e.apply(void 0,a);return C.toHandle(f)}function Yr(e,r){return e=C.toValue(e),r=C.toValue(r),C.toHandle(e[r])}function Gr(e){e>4&&(W[e].refcount+=1)}function Zr(e){return e=C.toValue(e),typeof e=="number"}var $r={};function Kr(e){var r=$r[e];return r===void 0?P(e):r}function Jr(e){return C.toHandle(Kr(e))}function Qr(e){var r=C.toValue(e);Be(r),me(e)}function en(e,r){e=we(e,"_emval_take_value");var n=e.readValueFromPointer(r);return C.toHandle(n)}function rn(){te("")}function nn(e,r,n){U.copyWithin(e,r,r+n)}function tn(){return 2147483648}function on(e){var r=K.buffer;try{return K.grow(e-r.byteLength+65535>>>16),Re(),1}catch{}}function an(e){var r=U.length;e=e>>>0;var n=tn();if(e>n)return!1;let i=(f,c)=>f+(c-f%c)%c;for(var o=1;o<=4;o*=2){var a=r*(1+.2/o);a=Math.min(a,e+100663296);var s=Math.min(n,i(Math.max(e,a),65536)),u=on(s);if(u)return!0}return!1}sr(),Me=t.BindingError=ge(Error,"BindingError"),De=t.InternalError=ge(Error,"InternalError"),gr(),xe=t.UnboundTypeError=ge(Error,"UnboundTypeError");var un={a:ur,q:fr,u:vr,t:_r,o:yr,h:Sr,d:Ir,c:Or,n:Vr,l:Nr,v:xr,k:zr,w:Xr,b:me,e:Yr,g:Gr,p:Zr,f:Jr,j:Qr,i:en,m:rn,s:nn,r:an},mn=ar(),fn=t.___wasm_call_ctors=function(){return(fn=t.___wasm_call_ctors=t.asm.y).apply(null,arguments)},be=t._malloc=function(){return(be=t._malloc=t.asm.z).apply(null,arguments)},L=t._free=function(){return(L=t._free=t.asm.A).apply(null,arguments)},qe=t.___getTypeName=function(){return(qe=t.___getTypeName=t.asm.C).apply(null,arguments)},sn=t.__embind_initialize_bindings=function(){return(sn=t.__embind_initialize_bindings=t.asm.D).apply(null,arguments)},cn=t.dynCall_ijiii=function(){return(cn=t.dynCall_ijiii=t.asm.E).apply(null,arguments)},se;ne=function e(){se||Xe(),se||(ne=e)};function Xe(e){if(e=e||v,G>0||($e(),G>0))return;function r(){se||(se=!0,t.calledRun=!0,!w&&(Ke(),g(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),Je()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),r()},1)):r()}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return Xe(),t.ready}})(),yn=Ee,Ae=new Uint8Array([0,0,0,1]);function dn(p){console.error(p)}Ee.createFile=Ye;function Ye(p=256){let h=0,t=0,g=new Uint8Array(p);return{contents:function(){return g.slice(0,t)},seek:function(l){h=l},write:function(l){let v=l.byteLength;return m(h+v),g.set(l,h),h+=v,t=Math.max(t,h),v}};function m(l){var v=g.length;if(v>=l)return;var M=1024*1024;l=Math.max(l,v*(v<M?2:1.125)>>>0),v!=0&&(l=Math.max(l,256));let D=g;g=new Uint8Array(l),t>0&&g.set(D.subarray(0,t),0)}}Ee.isWebCodecsSupported=Ge;function Ge(){return typeof window<"u"&&typeof window.VideoEncoder=="function"}function vn(p,h={}){let{width:t,height:g,groupOfPictures:m=20,fps:l=30,fragmentation:v=!1,sequential:M=!1,hevc:D=!1,format:j="annexb",codec:B="avc1.4d0034",acceleration:re,bitrate:y,error:k=dn,encoderOptions:z={},flushFrequency:oe=10}=h;if(!Ge())throw new Error("MP4 H264 encoding/decoding depends on WebCodecs API which is not supported in this environment");if(typeof t!="number"||typeof g!="number")throw new Error("Must specify { width, height } options");if(!isFinite(t)||t<0||!isFinite(g)||g<0)throw new Error("{ width, height } options must be positive integers");let q=Ye(),ae=p.create_muxer({width:t,height:g,fps:l,fragmentation:v,sequential:M,hevc:D},X),Te={codec:B,width:t,height:g,avc:{format:j},hardwareAcceleration:re,bitrate:y,...z},I=0,N=new window.VideoEncoder({output(w,b){K(w,b)},error:k});return N.configure(Te),{async end(){return await N.flush(),N.close(),p.finalize_muxer(ae),q.contents()},async addFrame(w){let b=1/l*I*1e6,O=I%m===0,E=new VideoFrame(w,{timestamp:b});N.encode(E,{keyFrame:O}),E.close(),oe!=null&&(I+1)%oe===0&&await N.flush(),I++},async flush(){return N.flush()}};function X(w,b,O){q.seek(O);let E=p.HEAPU8.subarray(w,w+b);return q.write(E)!==E.byteLength}function Fe(w){let b=p._malloc(w.byteLength);p.HEAPU8.set(w,b),p.mux_nal(ae,b,w.byteLength),p._free(b)}function K(w,b){let O=null,E;if(b&&(b.description&&(E=b.description),b.decoderConfig&&b.decoderConfig.description&&(E=b.decoderConfig.description)),E)try{O=gn(E)}catch(T){k(T);return}let V=[];if(O&&(O.sps_list.forEach(T=>{V.push(Ae),V.push(T)}),O.pps_list.forEach(T=>{V.push(Ae),V.push(T)})),j==="annexb"){let T=new Uint8Array(w.byteLength);w.copyTo(T),V.push(T)}else try{let T=new ArrayBuffer(w.byteLength);w.copyTo(T),hn(T).forEach(ce=>{V.push(Ae),V.push(ce)})}catch(T){k(T);return}Fe(pn(V))}}function pn(p){let h=p.reduce((m,l)=>m+l.byteLength,0),t=new Uint8Array(h),g=0;for(let m=0;m<p.length;m++){let l=p[m];t.set(l,g),g+=l.byteLength}return t}function hn(p){let t=0,g=[],m=p.byteLength,l=new Uint8Array(p);for(;t+4<m;){let v=l[t];if(v=(v<<8)+l[t+1],v=(v<<8)+l[t+2],v=(v<<8)+l[t+3],g.push(new Uint8Array(p,t+4,v)),v==0)throw new Error("Error: invalid nal_length 0");t+=4+v}return g}function gn(p){let h=new DataView(p),t=0,g=h.getUint8(t++),m=h.getUint8(t++),l=h.getUint8(t++),v=h.getUint8(t++),M=(h.getUint8(t++)&3)+1;if(M!==4)throw new Error("Expected length_size to indicate 4 bytes");let D=h.getUint8(t++)&31,j=[];for(let y=0;y<D;y++){let k=h.getUint16(t,!1);t+=2;let z=new Uint8Array(h.buffer,t,k);j.push(z),t+=k}let B=h.getUint8(t++),re=[];for(let y=0;y<B;y++){let k=h.getUint16(t,!1);t+=2;let z=new Uint8Array(h.buffer,t,k);re.push(z),t+=k}return{offset:t,version:g,profile:m,compat:l,level:v,length_size:M,pps_list:re,sps_list:j,numSPS:D}}export{Ye as createFile,vn as createWebCodecsEncoderWithModule,yn as default,Ge as isWebCodecsSupported};
//# sourceMappingURL=mp4.js.map
